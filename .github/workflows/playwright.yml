name: Playwright Tests

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '16'

      - name: Install required libraries (Chromium, Firefox, WebKit)
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            libwoff2-1 libvpx7 libevent-2.1-7 libgstgl-1.0-0 \
            libgstcodecparsers-1.0-0 libharfbuzz-icu0 libsecret-1-0 \
            libhyphen0 libmanette-0.2-0 libflite1 libflite-usenglish1 \
            libflite-cmu-grapheme-lang1 libflite-cmu-grapheme-lex1 \
            libflite-cmu-indic-lang1 libflite-cmu-indic-lex1 libflite-cmulex1 \
            libflite-cmu-time-awb1 libflite-cmu-us-awb1 libflite-cmu-us-kal16-1 \
            libflite-cmu-us-kal1 libflite-cmu-us-rms1 libflite-cmu-us-slt1 \
            libGLESv2-2 libx264-163

      - name: Install Playwright
        run: npm ci

      - name: Install Playwright Browsers (Chromium, Firefox, WebKit)
        run: npx playwright install chromium firefox webkit

      - name: Run tests on Firefox, Chromium, and WebKit in parallel
        run: |
          npx playwright test --project=firefox tests/formValidation.spec.ts &
          npx playwright test --project=chromium tests/formValidation.spec.ts &
          npx playwright test --project=webkit tests/formValidation.spec.ts &
          wait

      - name: Generate Playwright Test Reports
        run: |
          npx playwright test --reporter=html
          echo "Test report generated successfully"

      - name: Upload Playwright Test Report
        uses: actions/upload-artifact@v4
        with:
          name: playwright-report
          path: playwright-report/
